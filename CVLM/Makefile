.PHONY: help install setup-extension run-api run-streamlit test clean

help:
	@echo "ðŸš€ CVLM - Commandes disponibles"
	@echo ""
	@echo "Installation:"
	@echo "  make install          - Installer toutes les dÃ©pendances"
	@echo "  make setup-extension  - CrÃ©er la structure de l'extension"
	@echo ""
	@echo "Lancement:"
	@echo "  make run-api          - Lancer l'API (port 8000)"
	@echo "  make run-streamlit    - Lancer l'interface Streamlit"
	@echo ""
	@echo "Tests:"
	@echo "  make test             - Tester l'API"
	@echo "  make test-health      - Test rapide du health check"
	@echo ""
	@echo "Maintenance:"
	@echo "  make clean            - Nettoyer les fichiers temporaires"
	@echo "  make clean-all        - Nettoyage complet"

install:
	@echo "ðŸ“¦ Installation des dÃ©pendances..."
	pip install -r requirements.txt
	pip install fastapi uvicorn python-multipart pydantic
	@echo "âœ… DÃ©pendances installÃ©es"

setup-extension:
	@echo "ðŸ—ï¸  CrÃ©ation de la structure de l'extension..."
	python setup_extension.py
	@echo "âœ… Extension configurÃ©e"
	@echo ""
	@echo "âš ï¸  N'oubliez pas:"
	@echo "  1. Copier les fichiers dans extension/"
	@echo "  2. CrÃ©er les icÃ´nes dans extension/icons/"
	@echo "  3. Configurer .env avec vos clÃ©s API"

run-api:
	@echo "ðŸš€ Lancement de l'API CVLM..."
	python api_server.py

run-streamlit:
	@echo "ðŸš€ Lancement de l'interface Streamlit..."
	streamlit run streamlit_app.py

test:
	@echo "ðŸ§ª Tests de l'API..."
	python test_api.py

test-health:
	@echo "ðŸ” Test du health check..."
	@curl -s http://localhost:8000/health | python -m json.tool || echo "âŒ API non accessible"

clean:
	@echo "ðŸ§¹ Nettoyage des fichiers temporaires..."
	rm -rf data/temp/*
	rm -f temp_cv.pdf temp_jo.pdf lettre_motivation.pdf
	find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete
	@echo "âœ… Nettoyage terminÃ©"

clean-all: clean
	@echo "ðŸ§¹ Nettoyage complet..."
	rm -rf data/output/lettre_*.pdf
	rm -rf extension/
	@echo "âœ… Nettoyage complet terminÃ©"

dev:
	@echo "ðŸ”§ Mode dÃ©veloppement"
	@echo "Terminal 1: API"
	@echo "  make run-api"
	@echo ""
	@echo "Terminal 2: Tests"
	@echo "  make test"

.DEFAULT_GOAL := help